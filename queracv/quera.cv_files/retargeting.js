(function(){!function(){var e=window.Cookies,n=window.Cookies=function(){function u(){var e=0;var n={};for(;e<arguments.length;e++){var t=arguments[e];for(var r in t){n[r]=t[r]}}return n}function a(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}function e(f){function c(){}function t(e,n,t){if(typeof document==="undefined"){return}t=u({path:"/"},c.defaults,t);if(typeof t.expires==="number"){t.expires=new Date(new Date*1+t.expires*86400000)}t.expires=t.expires?t.expires.toUTCString():"";try{var r=JSON.stringify(n);if(/^[\{\[]/.test(r)){n=r}}catch(e){}n=f.write?f.write(n,e):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent);e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var o="";for(var i in t){if(!t[i]){continue}o+="; "+i;if(t[i]===true){continue}o+="="+t[i].split(";")[0]}return document.cookie=e+"="+n+o}function n(e,n){if(typeof document==="undefined"){return}var t={};var r=document.cookie?document.cookie.split("; "):[];var o=0;for(;o<r.length;o++){var i=r[o].split("=");var c=i.slice(1).join("=");if(!n&&c.charAt(0)==='"'){c=c.slice(1,-1)}try{var u=a(i[0]);c=(f.read||f)(c,u)||a(c);if(n){try{c=JSON.parse(c)}catch(e){}}t[u]=c;if(e===u){break}}catch(e){}}return e?t[e]:t}c.set=t;c.get=function(e){return n(e,false)};c.getJSON=function(e){return n(e,true)};c.remove=function(e,n){t(e,"",u(n,{expires:-1}))};c.defaults={};c.withConverter=e;return c}return e(function(){})}();n.noConflict=function(){return window.Cookies=e,n}}();function checkSupportLocalstorage(){try{localStorage.setItem("test","test");localStorage.removeItem("test");return !0}catch(e){return !1}}function getFromLocalStorage(key){return localStorage.getItem(key)}function setToLocalStorage(key,value){localStorage.setItem(key,value)}var eventMethod=window.addEventListener?"addEventListener":"attachEvent";var eventer=window[eventMethod];var messageEvent=eventMethod==="attachEvent"?"onmessage":"message";var localStorageFingerPrintKey="MEDIAAD_USER_ID";var fidHolder={val:null,listeners:[],set value(val){this.val=val;while(this.listeners.length>0){this.listeners.pop()(val)}},get value(){return this.val},listen:function(listener){this.listeners.push(listener)}};if(checkSupportLocalstorage()){fidHolder.value=getFromLocalStorage(localStorageFingerPrintKey)}else{if(Cookies.get(localStorageFingerPrintKey)){fidHolder.value=Cookies.get(localStorageFingerPrintKey)}}eventer(messageEvent,function(e){try{var message=e.data||e.message;if(message===null||message===undefined||typeof message.indexOf==="undefined"){return}if(message.indexOf("mediaad-fid:")===0){var fingerprint=message.split(":")[1];fidHolder.value=fingerprint;Cookies.set(localStorageFingerPrintKey,fingerprint,{expires:36500000});setToLocalStorage(localStorageFingerPrintKey,fingerprint)}}catch(e){console.log(e)}});function withFid(callback){var val=fidHolder.value;if(val){try{callback(val)}catch(e){}}else{fidHolder.listen(function(val){if(val){try{callback(val)}catch(e){}}})}}function appendIframe(src){if(src===null||src===undefined){return}var iFrame=document.createElement("iframe");iFrame.style.display="none";iFrame.src=src;try{document.body.appendChild(iFrame)}catch(e){console.log(e.message)}}var allTags=[{id:1199,title:"All Page Viewers",pattern_type:"contains",query:"/",trigger_type:"timeToStay",custom_script:null,css_selector:"",time_to_remain:0,element_id:"MED-Uorth"},{id:1209,title:"All Page",pattern_type:"contains",query:"",trigger_type:"showPage",custom_script:null,css_selector:"",time_to_remain:0,element_id:"MED-hvMhn"},{id:1456,title:"ماشین حساب حقوق",pattern_type:"contains",query:"/careers/calculator",trigger_type:"showPage",custom_script:null,css_selector:"",time_to_remain:0,element_id:"MED-vWrHP"}];var pageTags=[];var htmlElementTagToCounter={};var tagToTimeoutCounter={};var currentPath=getCurrentPath();var timeouts=[];var API_URL="https://api.mediaad.org";var SERVE_URL="https://api.mediaad.org/v1/events";var MAX_INTERVAL_RESET=60;setInterval(function(){checkUrlChange()},1000);updatePageTags();var urlParams=new URLSearchParams(window.location.search);if(urlParams.has("utm_ma")){Cookies.set("clickId",urlParams.get("utm_ma"),{expires:20})}window.addEventListener("load",function(){appendIframe("https://mediacdn.mediaad.org/static/fingerprint.html");withFid(function(fid){sendGetRequest(SERVE_URL+"/page/loaded?fid="+fid)});setTimeout(function(){sendGetRequest(SERVE_URL+"/session/10")},10000)});function getCurrentPath(){return decodeURIComponent(location.href.substr(location.origin.length))}function getCookie(name){var cookie=Cookies.get(name);if(cookie===undefined||cookie===null){return null}else{return cookie}}function refresh(){tagToTimeoutCounter={};htmlElementTagToCounter={};pageTags=[];var tempTimeouts=timeouts.slice();timeouts=[];var counter=0;if(tempTimeouts.length==0){updatePageTags()}tempTimeouts.forEach(function(timeout){clearTimeout(timeout);if(++counter==tempTimeouts.length){updatePageTags()}})}function updatePageTags(){pageTags=[];var counter=0;allTags.forEach(function(tag){if(isSuitable(tag)){pageTags.push(tag)}if(++counter==allTags.length){checkTagsTrigger()}})}function checkUrlChange(){var newPath=getCurrentPath();if(newPath!==currentPath){currentPath=newPath;refresh()}}function applyTriggerEvent(tag){if(tag.trigger_type==="showPage"){assignTagToUser(tag)}else{if(tag.trigger_type==="clickOnElement"){if(!(tag.css_selector in tagToTimeoutCounter)){tagToTimeoutCounter[tag.css_selector]=0}var checkExist=setInterval(function(){tagToTimeoutCounter[tag.css_selector]=tagToTimeoutCounter[tag.css_selector]+1;var elements=document.querySelectorAll(tag.css_selector);if(tagToTimeoutCounter[tag.css_selector]>=MAX_INTERVAL_RESET||elements.length>0){clearInterval(checkExist)}elements.forEach(function(element){element.addEventListener("click",function(){assignTagToUser(tag)})})},1000);timeouts.push(checkExist)}else{if(tag.trigger_type==="submitForm"){if(!(tag.css_selector in tagToTimeoutCounter)){tagToTimeoutCounter[tag.css_selector]=0}var checkExist=setInterval(function(){tagToTimeoutCounter[tag.css_selector]=tagToTimeoutCounter[tag.css_selector]+1;var elements=document.querySelectorAll(tag.css_selector);if(tagToTimeoutCounter[tag.css_selector]>=MAX_INTERVAL_RESET||elements.length>0){clearInterval(checkExist)}elements.forEach(function(element){element.addEventListener("submit",function(){console.log("onSubmitListener added");assignTagToUser(tag)})})},1000);timeouts.push(checkExist)}else{if(tag.trigger_type==="timeToStay"){var timeout=setTimeout(function(){assignTagToUser(tag)},tag.time_to_remain*1000);timeouts.push(timeout)}else{if(tag.trigger_type==="customScript"){try{var result=eval(tag.custom_script);if(result===true){assignTagToUser(tag)}}catch(e){console.log(e)}}}}}}}function checkTagsTrigger(){pageTags.forEach(function(tag){applyTriggerEvent(tag)})}function assignTagToUser(tag){var tagName="MED-tag-"+tag.id;if(sessionStorage.getItem(tagName)){return}try{withFid(function(fid){sendPostRequest(SERVE_URL+"/add-tag-to-visitor?fid="+fid,{tagId:tag.id,date:Date.now()})});var clickId=getCookie("clickId");if(clickId!==null){sendGetRequest(SERVE_URL+"/post-back?actionName="+tag.title+"&clickId="+clickId)}}finally{sessionStorage.setItem(tagName,"1")}}function isPrefix(mainString,prefix){return(mainString.substring(0,prefix.length)===prefix)}function isPostfix(mainString,postfix){return(mainString.substring(mainString.length-postfix.length,mainString.length)===postfix)}function isSuitable(tag){currentPath=getCurrentPath();if(tag.pattern_type==="startsWith"){return isPrefix(currentPath,tag.query)}else{if(tag.pattern_type==="htmlElement"){htmlElementTagToCounter[tag.id]=0;var checkExist=setInterval(function(){htmlElementTagToCounter[tag.id]=htmlElementTagToCounter[tag.id]+1;var element=document.getElementById(tag.element_id);if(element!=null){htmlElementTagToCounter[tag.id]=MAX_INTERVAL_RESET;clearInterval(checkExist);applyTriggerEvent(tag)}if(htmlElementTagToCounter[tag.id]>=MAX_INTERVAL_RESET){clearInterval(checkExist)}},1000);timeouts.push(checkExist);return false}else{if(tag.pattern_type==="endsWith"){return isPostfix(currentPath,tag.query)}else{if(tag.pattern_type==="equalsTo"){return currentPath===tag.query}else{if(tag.pattern_type==="contains"){return currentPath.includes(tag.query)}else{if(tag.pattern_type==="regex"){var pattern=new RegExp(tag.query);return pattern.test(currentPath)}}}}}}}function sendPostRequest(link,obj){var xhr=new XMLHttpRequest();xhr.open("POST",link);xhr.withCredentials=!0;xhr.setRequestHeader("Content-Type","application/json; charset=utf-8");if(obj){xhr.send(JSON.stringify(obj))}else{xhr.send()}}function sendGetRequest(link){var xhr=new XMLHttpRequest();xhr.open("GET",link);xhr.send(null)}})();